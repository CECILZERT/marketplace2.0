# 1. Image Node stable
FROM node:18-alpine AS build

# 2. Dossier de travail
WORKDIR /app

# 3. Copier les fichiers du projet
COPY package*.json ./
COPY yarn.lock ./

# 4. Installer les dépendances
RUN yarn install || npm install

# 5. Copier tout le code
COPY . .

# 6. Construire le frontend
RUN yarn build || npm run build

# ----------------------------
# Étape 2 : Serveur web Nginx
# ----------------------------
FROM nginx:alpine

# Copier le dossier build CRA
COPY --from=build /app/build /usr/share/nginx/html

# Render utilise le port 10000
EXPOSE 10000

# Lancer nginx
CMD ["nginx", "-g", "daemon off;"]
